<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Display All Employees</title>
    
    <!-- Bootstrap 5.1 CSS -->
    <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
    crossorigin="anonymous"
    />

    <!-- Bootstrap 5.1 JS Bundle -->
    <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
    crossorigin="anonymous"
    ></script>

    <style>
    /* Hand on hover */
    .clickable-row:hover {
      cursor: pointer;
      background-color: #f5f5f5;
    }
    </style>

</head>
<body>
    <!-- Navigation bar -->
    {{> navbar}}

    <h2>Click ROW to edit Employee ***</h2>

    <!-- Table of employees -->
    <div class="container mt-4">
        <table class="table">
            <thead>
            <tr>
                <th scope="col">Employee ID</th>
                <th scope="col">Name</th>
                <th scope="col">Email</th>
                <th scope="col">Phone Number</th>
                <th scope="col">Hire Date</th>
                <th scope="col">Job ID</th>
                <th scope="col">Salary</th>
                <th scope="col">Commission %</th>
                <th scope="col">Manager ID</th>
                <th scope="col">Dept. ID</th>
            </tr>
            </thead>
            <tbody>
                <!-- Rows -->
            </tbody>
        </table>
    </div>


    <!-- Bootstrap Bundle with Popper 
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>
    -->

    <script>
    async function populateTable() {
        const tableBody = document.querySelector('.table tbody');
        try {
            // Fetch
            const response = await fetch('/api/getemployeesinfo');
            const employees = await response.json();

            // To be used in date formatting
            const monthNames = ["JAN", "FEB", "MAR", "APR", "MAY", "JUN", "JUL", "AUG", "SEP", "OCT", "NOV", "DEC"];

            // Iterate
            employees.forEach(employee => {
                const row = document.createElement('tr');
                const properties = ['EMPLOYEE_ID', 'NAME', 'EMAIL', 'PHONE_NUMBER', 'HIRE_DATE', 'JOB_ID', 'SALARY', 'COMMISSION_PCT', 'MANAGER_ID', 'DEPARTMENT_ID'];
                properties.forEach(property => {
                    const cell = document.createElement('td');
                    
                    if (property === 'NAME') {
                        cell.textContent = `${employee['FIRST_NAME']} ${employee['LAST_NAME']}`;
                    } else if (property === 'HIRE_DATE') {
                        const date = new Date(employee[property]);
                        cell.textContent = `${monthNames[date.getMonth()]}-${date.getDate().toString().padStart(2, '0')}-${date.getFullYear()}`;
                    /* Design choice
                    } else if (property === 'COMMISSION_PCT')  {
                        const percentage = employee.COMMISSION_PCT * 100;
                        cell.textContent = `${percentage}%`; 
                    */
                    } else {
                        cell.textContent = employee[property] || ''; 
                    }

                    row.appendChild(cell);
                });
                // Append
                tableBody.appendChild(row);
            });
        } catch (error) {
            console.error('Could not load the data:', error);
        }
    }

    populateTable();    
    </script>

</body>
</html>